/* Script:Conde%20Shared%20Tag - ScriptInstance:efb951fafbc342b5a962c4cb6cfa70c5 - CompiledAt:2019-01-11 15:28:55 */

(function(){window.PolarConde=window.PolarConde||[];var exec=function(item){log("Message received with contents:",item);var name;if(typeof item!=="object"||item.length<1||typeof(name=item[0])!=="string"){return}switch(name){case"onRender":onRender(item[1]);break;case"onFill":onFill(item[1],item[2]);break;case"onError":onError(item[1],item[2],item[3]);break;default:break}};var log=function(){if(window.location.search.indexOf("mvdebug=1")>-1){var args=1<=arguments.length?[].slice.call(arguments,0):[];args.unshift("[PolarConde]");console.log.apply(console,args)}};var init=function(){window.NATIVEADS=window.NATIVEADS||{};window.NATIVEADS_QUEUE=window.NATIVEADS_QUEUE||[];injectScript("nativeads-plugin","//plugin.mediavoice.com/plugin.js")};var boot=function(){var existingQueue=window.PolarConde;window.PolarConde={push:function(){var items=1<=arguments.length?[].slice.call(arguments,0):[];for(var i=0;i<items.length;i++){exec(items[i])}}};if(typeof existingQueue==="object"){for(var i=0;i<existingQueue.length;i++){exec(existingQueue[i])}existingQueue=null}};var getPropertyID=function(hostname,organization,callback){var request=new XMLHttpRequest;request.open("GET","//polarcdn-terrax.com/nativeads/v1.4.0/json/hostname/"+hostname+"/organization/"+organization,true);request.onload=function(){if(request.status>=200&&request.status<400){var data=JSON.parse(request.responseText);log("[Property ID Lookup] Response:",data);callback(null,data.property)}else{log("[Property ID Lookup] Server responded with error:",request.status,request.statusText);callback(true)}};request.onerror=function(){log("[Property ID Lookup] Connection error.");callback(true)};request.send()};var onRender=function(context){var $=context.$;var destinationURLs=$.map(context.fill.creatives,function(creative,index){return creative.link});context.$template.find("a").each(function(){var element=$(this);var url=element.attr("href");destinationURLs.forEach(function(destinationURL){if(url.length>0&&destinationURL.indexOf(url.split("?")[0])!=-1&&url.indexOf("#polar-deck-link")<0){var urlObj={intcid:"polar",utm_source:"polar",utm_medium:"nativetile"};var updatedURL=updateQueryStringParameter(url,urlObj);element.attr("href",updatedURL);log("[Render] Updated destination URL:",{from:url,to:updatedURL})}})})};var onFill=function(context,creative,jQuery){context.creatives.forEach(function(creative){var url=creative.link;if(url.indexOf("#polar-deck-link")<0){var urlObj={intcid:"polar",utm_source:"polar",utm_medium:"nativetile"};var updatedURL=updateQueryStringParameter(url,urlObj);creative.link=updatedURL;log("[Fill] Updated destination URL:",{from:url,to:updatedURL})}})};var onError=function(context,srcWindow,config){};var updateQueryStringParameter=function(url,obj){for(key in obj){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i");var separator=url.indexOf("?")!==-1?"&":"?";if(url.match(re)){url=url.replace(re,"$1"+key+"="+obj[key]+"$2")}else{url=url+separator+key+"="+obj[key]}}return url};var injectScript=function(id,url){(function(d,s,i,u){var js,fjs=d.getElementsByTagName(s)[0],p=d.location.protocol;if(d.getElementById(i)){return}js=d.createElement(s);js.id=i;js.type="text/javascript";js.async=true;js.src=(p=="https:"?p:"http:")+u;fjs.parentNode.insertBefore(js,fjs)})(document,"script",id,url)};log("Loading MV Script.");init();boot();log("Loaded MV Script.");log("Looking up MV Property ID.");getPropertyID(window.location.hostname,"condenastcorporate",function(error,property){if(error!=null){log("Unable to determine Property ID.");log("Will not enable secondary page tracking, because Property ID unknown.");return}log("MV Property ID is:",property);window.NATIVEADS_QUEUE.push(["setPropertyID",property]);if(property==="NA-WIRE-11238836"){log("Injecting Wired-specific script.");injectScript("nativeads-wired-hosted","//polarcdn-terrax.com/nativeads/script/condenastcorporate/wired-hosted-content.js");return}window.NATIVEADS_QUEUE.push(["configureSecondaryPage",{track:function(){log("Configuring secondary page tracking.");if(window.location.pathname.indexOf("/branded")==0||window.location.pathname.indexOf("/brandlab")==0||window.location.pathname.indexOf("sponsor-content")>-1||window.location.search.indexOf("mvt=i")>-1||window.location.search.indexOf("mvt=o")>-1||window.location.search.indexOf("plrsrc=")>-1){log("This is a branded content page (because `/branded` or `/brandlab` or contains `sponsor-content` or `?intcid=polar` or `?plrsrc=`); tracking pageview.");return"inbound"}else{log("This is not a branded content page; not tracking pageview.");return false}}}])})})();
