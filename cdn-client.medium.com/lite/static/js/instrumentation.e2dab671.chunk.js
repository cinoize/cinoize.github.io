(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{"./src/framework/perf/PerformanceLogger.ts":function(e,n,t){"use strict";t.r(n);var r=t("./node_modules/opentracing/lib/index.js"),o=t("./node_modules/react/index.js"),i=t("./node_modules/react-redux/es/index.js"),s=t("./src/components/session/useFlag.tsx"),c=t("./src/framework/reporter/performance.tsx"),a=t("./src/routes/RoutingContext.tsx"),u=t("./src/store/actions/debug.ts"),l=t("./src/store/selectors/session.ts"),f=t("./src/util/performance.ts"),d=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),p=t.n(d),m=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),g=t.n(m),b=t("./src/log/datapupLogger.ts"),v=t("./src/util/observable/index.ts");function h(){for(var e=new v.a,n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];if(0===t.length)return e;var o=t.map((function(){return[]}));return t.forEach((function(n,t){n.observe((function(n){o[t].push(n),o.every((function(e){return e.length>0}))&&e.set(o.map((function(e){return e.shift()})))}))})),e}var _=function(e){return function(n){return g()({},e,n)}};n.default=function(){var e,n;return n={glyph_embed_commands:null!==(e=Object(s.c)().glyph_embed_commands)&&void 0!==e?e:"control"},o.useEffect((function(){var e=h(f.f,f.d,f.b).map((function(e){var n=p()(e,3),t=n[0],r=n[1],o=n[2];return{responseEndToLCP:new f.a(t.response.end,r.end),responseEndToFCP:new f.a(t.response.end,o.end)}})),t=h(f.f,f.c.map(_("fid")),f.b.map(_("fcp")),f.d.map(_("lcp")),e);f.h.observe((function(e){e||h(t,f.g).observe((function(e){var t=p()(e,2),r=t[0],o=t[1],i=r.reduce((function(e,n){return Object.assign(e,n)}),{}),s=Object.keys(i).reduce((function(e,n){var t=i[n].duration;return e[n]=t%1==0?t:Number(t.toFixed(1)),e}),{});b.a.log("client hydrated",{perf:s,resources:o,experimentFlags:n})}))}))}),[]),function(){var e,n=Object(i.f)((function(e){return e.tracing.tracer})),t=Object(i.f)((function(e){return e.tracing.originalSpan})),d=Object(i.f)((function(e){return e.client.isBot})),p=Object(i.f)((function(e){return e.client.isCustomDomain})),m=Object(i.f)((function(e){return e.session.user.id})),g=Object(i.f)((function(e){return e.config.performanceTags})),b=Object(i.e)(),v=Object(c.c)(),h=Object(a.c)(),_=null!==(e=Object(s.c)().glyph_embed_commands)&&void 0!==e?e:"control";o.useEffect((function(){var e;if(n&&v&&!d){var o=h(window.location.pathname),i=null!==(e=null==o?void 0:o.route.metricName)&&void 0!==e?e:"unidentified",s={"user.logged_in":Object(l.a)(m),"req.route_name":i,"req.route":i,"req.glyph_embed":_,"req.is_custom_domain":p};g.forEach((function(e){return s["req.".concat(e)]=1}));var c={loggedIn:Object(l.a)(m),route:i,withinPostInternalLinksExperiment:g.includes("post_internal_links")},a=function(e){return Math.round(1e3*e)},j=function(e,t,r,o){var i=r.start,c=r.end,u=n.startSpan("timing.".concat(t),{childOf:e,tags:s}).setBeginMicros(a(i)).setEndMicros(a(c));return null!=o&&o(u),u.finish(),u};f.f.observe((function(e){var o,i,l,f;v.reportRender(c,e);var d=n.startSpan("timing.navigation",{references:t?[Object(r.followsFrom)(t)]:void 0,tags:s}).setBeginMicros(a(e.load.start)).setEndMicros(a(e.load.end)).log({redirect_count:null!==(o=null===(i=window)||void 0===i||null===(l=i.performance)||void 0===l||null===(f=l.navigation)||void 0===f?void 0:f.redirectCount)&&void 0!==o?o:0});j(d,"beforeDomainLookup",e.beforeDomainLookup),j(d,"domainLookup",e.domainLookup),j(d,"connect",e.connect),j(d,"request",e.request),j(d,"response",e.response),j(d,"processing",e.processing);var p=e.overallFCP,m=e.client,g=e.render;null!=p&&j(d,"firstContentfulPaint",p),null!=m&&j(d,"client",m,(function(e){null!=g&&j(e,"render",g)})),d.finish(),b(Object(u.c)(d.generateTraceURL()))})),f.b.observe((function(e){v.reportFirstContentfulPaint(c,e),n.startSpan("timing.firstContentfulPaint.v2",{references:t?[Object(r.followsFrom)(t)]:void 0,tags:s}).setBeginMicros(a(e.start)).setEndMicros(a(e.end)).finish()})),f.d.observe((function(e){v.reportLargestContentfulPaint(c,e),n.startSpan("timing.largestContentfulPaint",{references:t?[Object(r.followsFrom)(t)]:void 0,tags:s}).setBeginMicros(a(e.start)).setEndMicros(a(e.end)).finish()})),f.h.observe((function(e){e&&v.reportUnsupportedPerfObserver(c)})),f.c.observe((function(e){v.reportInput(c,e),n.startSpan("timing.input.first.delay",{references:t?[Object(r.followsFrom)(t)]:void 0,tags:s}).setBeginMicros(a(e.start)).setEndMicros(a(e.end)).finish()}))}}),[n])}(),null}},"./src/util/tracing.ts":function(e,n,t){"use strict";t.r(n),t.d(n,"init",(function(){return i})),t.d(n,"extractSpan",(function(){return s}));var r=t("./node_modules/lightstep-tracer/browser.js"),o=t("./node_modules/opentracing/lib/index.js"),i=function(e){var n=e.name,t=e.host,i=e.token,s=e.appVersion,c=new r.Tracer({component_name:n,xhr_instrumentation:!1,access_token:i,collector_host:t,default_span_tags:{"component.version":s}});return Object(o.initGlobalTracer)(c),c},s=function(e,n){if(n)return e.extract(o.FORMAT_HTTP_HEADERS,n)}}}]);
//# sourceMappingURL=instrumentation.e2dab671.chunk.js.map